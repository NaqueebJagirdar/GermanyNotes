{% extends "base.html" %}

{% block title %}Notes for {{ category }}{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center">Notes for Category: {{ category }}</h1>

    <!-- Add New Note Form -->
    <h2 class="mt-4">Add a New Note</h2>
    <form method="POST" action="{{ url_for('add_category_notes', category=category) }}">
        <div class="form-group">
            <label for="title">Title</label>
            <input type="text" class="form-control" id="title" name="title" required>
        </div>
        <div class="form-group">
            <label for="content">Content</label>
            <textarea class="form-control" id="content" name="content" rows="4" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Add Note</button>
    </form>

    <!-- Display Existing Notes -->
<h2 id="existing-notes" class="mt-5">Existing Notes</h2>
{% if notes %}
<div class="scrollable-notes mt-3">
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Title</th>
                <th>Content</th>
                <th>Editor</th> <!-- New column for Editor -->
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for note in notes|reverse %}
            <tr>
                <td>{{ note.title }}</td>
                <td>{{ note.content }}</td>
                <td>{{ note.editor_name }}</td> <!-- Display Editor -->
                <td>
                    <span class="badge {% if note.status == 'Completed' %}bg-success{% elif note.status == 'In-Query' %}bg-warning{% endif %}">
                        {{ note.status }}
                    </span>
                </td>
                <td>
                    <!-- Status Buttons -->
                    <form method="POST" action="{{ url_for('update_note_status', note_id=note.id, category=category) }}" style="display:inline;">
                        <input type="hidden" name="status" value="In-Query">
                        <button type="submit" class="btn btn-warning btn-sm" {% if note.status == 'In-Query' %}disabled{% endif %}>
                            In-Query
                        </button>
                    </form>
                    <form method="POST" action="{{ url_for('update_note_status', note_id=note.id, category=category) }}" style="display:inline;">
                        <input type="hidden" name="status" value="Completed">
                        <button type="submit" class="btn btn-success btn-sm" {% if note.status == 'Completed' %}disabled{% endif %}>
                            Completed
                        </button>
                    </form>
                    <button class="btn btn-warning btn-sm" onclick="toggleEdit({{ note.id }})">Edit</button>
                    <form method="POST" action="{{ url_for('delete_note', note_id=note.id, category=category) }}" style="display:inline;">
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<p class="text-muted">No notes available for this category.</p>
{% endif %}
</div>

<!-- Inline Editing Script -->
<script>
    function toggleEdit(noteId) {
        const viewNote = document.getElementById(`view-note-${noteId}`);
        const editNote = document.getElementById(`edit-note-${noteId}`);
        viewNote.classList.toggle('d-none');
        editNote.classList.toggle('d-none');
    }
</script>
{% endblock %}