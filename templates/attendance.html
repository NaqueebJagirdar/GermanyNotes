{% extends "base.html" %}
{% block title %}Attendance{% endblock %}
{% block content %}
<div class="attendance-container mt-5">
    <h1 class="text-center">Attendance</h1>
    <!-- Display Current Date -->
    <p class="text-center mt-3">
        <strong>Today's Date:</strong>
        <span>{{ date_dd_mm_yyyy }}</span>
        (<span>{{ date_words }}</span>)
    </p>
    <!-- Add New Colleague Form -->
    <form method="POST" action="{{ url_for('add_colleague') }}" class="mb-4">
        <div class="form-group">
            <input type="text" name="name" class="form-control" placeholder="Enter colleague's name" required>
        </div>
        <button type="submit" class="btn btn-primary">Add Colleague</button>
    </form>

    <!-- Attendance Tables -->
    <table class="attendance-table table table-bordered table-hover mt-4">
        <thead>
            <tr>
                <th>Name</th>
                <th>Status</th>
                <th>Actions</th>
                <th>Role</th>
            </tr>
        </thead>
        <tbody>
            {% for colleague in colleagues %}
            <tr id="row-{{ colleague.id }}" class="{% if colleague.role == 'Coordinator' %}coordinator-highlight{% elif colleague.role == 'Presenter' %}presenter-highlight{% elif colleague.role == 'Editor' %}editor-highlight{% endif %}">
                <!-- Colleague Name -->
                <td>{{ colleague.name }}</td>

                <!-- Attendance Status -->
                <td>
                    <span class="{% if colleague.status == 'Present' %}badge-present{% else %}badge-absent{% endif %}">
                        {{ colleague.status }}
                    </span>
                </td>

                <!-- Actions (Update, Edit, Delete) -->
                <td>
                    <!-- Mark Present -->
                    <form method="POST" action="{{ url_for('update_status', colleague_id=colleague.id) }}" style="display:inline;">
                        <input type="hidden" name="status" value="Present">
                        <button type="submit" class="attendance-btn-sm btn btn-success" {% if colleague.status == 'Present' %}disabled{% endif %}>
                            Mark Present
                        </button>
                    </form>

                    <!-- Mark Absent -->
                    <form method="POST" action="{{ url_for('update_status', colleague_id=colleague.id) }}" style="display:inline;">
                        <input type="hidden" name="status" value="Absent">
                        <button type="submit" class="attendance-btn-sm btn btn-danger" {% if colleague.status == 'Absent' %}disabled{% endif %}>
                            Mark Absent
                        </button>
                    </form>

                    <!-- Edit -->
                    <button class="attendance-btn-sm btn btn-warning" onclick="toggleEdit({{ colleague.id }})">Edit</button>

                    <!-- Delete -->
                    <form method="POST" action="{{ url_for('delete_colleague', colleague_id=colleague.id) }}" style="display:inline;">
                        <button type="submit" class="attendance-btn-sm btn btn-danger">Delete</button>
                    </form>
                </td>

                <!-- Role Assignment -->
                <td>
                    <select class="role-dropdown" onchange="assignRole({{ colleague.id }}, this.value)">
                        <option value="" {% if not colleague.role %}selected{% endif %}>Assign Role</option>
                        <option value="Coordinator" {% if colleague.role == 'Coordinator' %}selected{% endif %}>Coordinator</option>
                        <option value="Presenter" {% if colleague.role == 'Presenter' %}selected{% endif %}>Presenter</option>
                        <option value="Editor" {% if colleague.role == 'Editor' %}selected{% endif %}>Editor</option>
                    </select>
                </td>
            </tr>

            <!-- Edit Form (Initially Hidden) -->
            <tr id="edit-row-{{ colleague.id }}" class="hidden-form">
                <td colspan="4">
                    <form method="POST" action="{{ url_for('edit_colleague', colleague_id=colleague.id) }}">
                        <div class="form-group">
                            <input type="text" name="name" class="form-control" value="{{ colleague.name }}" required>
                        </div>
                        <button type="submit" class="btn btn-success btn-sm">Save</button>
                        <button type="button" class="btn btn-secondary btn-sm" onclick="toggleEdit({{ colleague.id }})">Cancel</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Inline JavaScript to Toggle Edit Form and Assign Roles -->
<script>
    function toggleEdit(colleagueId) {
        const editRow = document.getElementById(`edit-row-${colleagueId}`);
        editRow.classList.toggle('hidden-form');
    }

    function assignRole(colleagueId, role) {
        // Remove all existing role highlights
        const row = document.getElementById(`row-${colleagueId}`);
        row.classList.remove('coordinator-highlight', 'presenter-highlight', 'editor-highlight');

        // Add appropriate highlight based on the selected role
        if (role === 'Coordinator') row.classList.add('coordinator-highlight');
        else if (role === 'Presenter') row.classList.add('presenter-highlight');
        else if (role === 'Editor') row.classList.add('editor-highlight');
    }
</script>
{% endblock %}
